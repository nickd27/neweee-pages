<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Контакты — форма</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; line-height: 1.5; }
    form { max-width: 560px; display:grid; gap:.75rem; }
    input, textarea, button { font: inherit; padding:.6rem .7rem; }
    textarea { min-height: 140px; }
    .ok { color: green; }
    .err { color: #c00; }
  </style>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
  <h1>Контакты</h1>
 <form id="contactForm" action="/contact" method="POST">
  <input name="name" placeholder="Ваше имя" required>
  <input name="email" type="email" placeholder="Ваш e-mail" required>
  <textarea name="message" placeholder="Сообщение" required></textarea>

  <!-- Скрытое поле под токен Turnstile -->
  <input type="hidden" name="cf-turnstile-response" id="ts-response">

  <!-- Виджет Turnstile ДОЛЖЕН быть ВНУТРИ <form> -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <div class="cf-turnstile"
       data-sitekey="0x4AAAAAABzsfweLC5RtGe8B"
       data-callback="tsOnSuccess"
       data-expired-callback="tsOnExpired"
       data-error-callback="tsOnError"></div>

  <button type="submit">Отправить</button>
</form>

<script>
// Коллбэки Turnstile заполняют/очищают скрытое поле
function tsOnSuccess(token) {
  document.getElementById('ts-response').value = token || '';
}
function tsOnExpired() {
  document.getElementById('ts-response').value = '';
}
function tsOnError() {
  document.getElementById('ts-response').value = '';
}

// (необязательно) если у тебя JS-отправка через fetch:
// оставь как есть, только перед отправкой проверяй наличие токена:
const form = document.getElementById('contactForm');
form.addEventListener('submit', (e) => {
  const tok = document.getElementById('ts-response').value;
  if (!tok) {
    e.preventDefault();
    alert('Подтвердите проверку “Я не робот” и попробуйте снова.');
  }
}, { capture: true });
</script>

</body>
</html>
